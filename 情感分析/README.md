# 上海CityWalk打卡点情感分析系统 - 使用指南

## 📋 项目简介

本系统用于分析游客对上海CityWalk各打卡点的评价情感，通过以下步骤完成分析：

1. **数据加载** - 读取评论数据文件
2. **文本预处理** - 清理文本内容
3. **打卡点提取** - 识别评论中提及的地点
4. **情感分析** - 对每条评论进行情感评分（0-1分）
5. **综合评分** - 为每个打卡点生成总体情感评分
6. **可视化展示** - 生成分析报告和图表

## 🚀 快速开始

### 方法一：直接运行（推荐）

**Windows用户：** 在文件夹中找到 `快速启动.py` 或 `run.bat`，双击运行

**Mac/Linux用户：** 在终端中运行
```bash
python run_analysis.py
```

### 方法二：使用Python IDE

在VS Code或PyCharm中打开 `run_analysis.py`，按 `F5` 运行

## 📊 输入数据格式

### 数据文件位置
程序会按以下顺序查找数据文件：
1. 同目录下的 `dedup_data.csv` 或 `dedup_data.xlsx`
2. 桌面的 `dedup_data.xlsx`
3. 如果都没有，则使用内置示例数据

### 数据文件要求

**CSV格式示例：**
```
content
武康路上的老洋房充满历史气息，散步很舒服，值得一来
新天地的建筑很有设计感，但消费太高，有点失望
豫园是上海的标志性景点，园林设计精妙，很值得看
```

**必须包含的列：**
- `content` - 评论文本内容
- 或者含有 "内容"、"评论"、"文本" 等关键字的列

**支持的格式：**
- ✅ CSV (.csv)
- ✅ Excel (.xlsx)
- ✅ Excel (.xls)

## 📍 支持的打卡点列表

系统内置了25个常见的上海CityWalk打卡点：

| 区域 | 打卡点 |
|------|--------|
| 浦西主要 | 外滩、南京路、豫园、城隍庙、田子坊、新天地 |
| 法租界 | 武康路、安福路、思南公馆 |
| 静安区 | 静安寺、愚园路、上生新所 |
| 浦东 | 陆家嘴、迪士尼 |
| 郊区古镇 | 朱家角、枫泾、七宝 |
| 其他 | M50、1933、淮海路、甜爱路、多伦路、徐家汇、龙华寺 |

**自定义打卡点：** 编辑 `run_analysis.py` 中的 `landmarks` 列表

## 💯 情感分析算法

使用**关键词权重法**进行情感分析：

### 积极词汇权重（0.7-0.95分）
- 非常积极：很棒(0.9)、很漂亮(0.9)、完美(0.95)
- 积极：很好(0.85)、值得(0.85)、推荐(0.9)、喜欢(0.85)
- 中等积极：不错(0.8)、有趣(0.85)、特色(0.75)、独特(0.75)

### 否定词汇权重（0.1-0.4分）
- 非常负面：骗(0.1)、讨厌(0.05)
- 负面：很差(0.15)、失望(0.25)、拥挤(0.3)、排队(0.35)
- 中等负面：不好(0.2)、费钱(0.3)、贵(0.35)、冷清(0.35)

### 算分规则
```
情感得分 = 正面词汇权重和 / (正面词汇权重和 + 负面词汇权重和)
范围：0.0（完全负面） 到 1.0（完全正面）
```

### 情感等级划分
- **强正面** ≥ 0.7 (⭐⭐⭐⭐⭐)
- **正面** 0.6 ≤ score < 0.7 (⭐⭐⭐⭐)
- **中立** 0.4 ≤ score < 0.6 (⭐⭐⭐)
- **负面** < 0.4 (⭐⭐)

## 📈 输出结果

### 生成的文件

1. **citywalk_analysis_results.csv** - 详细数据表格
   - Landmark: 打卡点名称
   - Score: 情感得分（0-1）
   - Grade: 情感等级
   - Positive: 积极评论数
   - Negative: 负面评论数
   - PosRate: 积极评论比例
   - Count: 总评论数
   - Sample: 代表评论示例

2. **citywalk_analysis_results.png** - 可视化报告，包含4张图表
   - 左上：各打卡点的情感得分排行
   - 右上：评论数量分布
   - 左下：各打卡点的积极评论率
   - 右下：情感等级分布饼图

### 控制台输出

程序运行过程中会显示：
- ✅ 数据加载状态
- 🔄 文本预处理进度
- 🔍 识别到的打卡点列表
- 🚀 实时情感分析进度
- 📋 完整结果表格
- 🏆 Top 5推荐打卡点
- 💡 深度洞察分析报告

## ⚙️ 高级设置

### 修改打卡点列表

编辑 `run_analysis.py` 文件，找到此部分：
```python
landmarks = [
    '外滩', '南京路', '豫园', '城隍庙', '田子坊', '新天地',
    # 添加或删除打卡点...
]
```

### 调整情感词汇权重

编辑 `SimpleSentimentAnalyzer` 类中的：
```python
self.positive_words = {
    '很棒': 0.9,  # 修改权重值
    '很好': 0.85,
    # 添加新词汇...
}
```

### 改变输出文件名

在 `main()` 函数中修改：
```python
csv_path = 'citywalk_analysis_results.csv'  # 修改这里
png_path = 'citywalk_analysis_results.png'  # 修改这里
```

## 🔧 故障排查

### 问题：找不到数据文件

**解决方案：**
- 确保CSV或Excel文件与脚本在同一目录
- 或将文件放在桌面
- 检查文件名是否正确：`dedup_data.csv` 或 `dedup_data.xlsx`
- 文件必须包含 `content` 列

### 问题：打卡点识别不到

**原因和解决：**
- 数据中没有包含打卡点名称 → 检查数据内容
- 打卡点名称拼写不同 → 编辑 `landmarks` 列表添加别名
- 例如：如果用"外滩滨江"而不是"外滩"，需要在列表中添加

### 问题：显示乱码

**解决方案：**
- 确保数据文件使用UTF-8编码
- 在Excel中：另存为 → CSV UTF-8格式
- 或使用 `run_analysis.py` 而不是 `citywalk_analysis.py`

### 问题：图表无法显示

**原因和解决：**
- 缺少matplotlib库 → 运行 `pip install matplotlib`
- 中文字体缺失 → 自动使用系统字体
- 磁盘空间不足 → 清理硬盘

## 📊 分析示例

### 输出示例

```
======================================================================
         Shanghai CityWalk Sentiment Analysis System
======================================================================

Data samples: 25 comments

Preprocessing text...
Valid text: 25/25 (100.0%)

Extracting landmarks...

Found 19 landmarks:
   1. 武康路        (  3 comments)
   2. 外滩          (  3 comments)
   3. 豫园          (  2 comments)
   ...

======================================================================
              Running Sentiment Analysis...
======================================================================

[1/19] Analyzing 武康路        -> 0.829
[2/19] Analyzing 外滩          -> 0.642
[3/19] Analyzing 豫园          -> 0.783
...

======================================================================
               Saving Results
======================================================================

CSV file: citywalk_analysis_results.csv
PNG file: citywalk_analysis_results.png

Analysis Results:

 Rank | Landmark     | Score  | Grade     | Pos%   | Count | Sample
------+--+-----+-----+-----------+------+------+-----+
    1 | 豫园         |  0.783 | Positive  |  100% |     2 | 豫园是上海的标志性景点
    2 | 武康路       |  0.829 | Positive  |   66% |     3 | 武康路上的老洋房充满历
    3 | 静安寺       |  0.750 | Positive  |   66% |     3 | 静安寺很宁静祥和，虽然
    ...

======================================================================
        TOP 5 RECOMMENDED LANDMARKS
======================================================================

1. 武康路       | Score: 0.829 ***** | Comments: 3
2. 豫园         | Score: 0.783 **** | Comments: 2
3. 朱家角       | Score: 0.775 **** | Comments: 1
...

Overall Assessment:
  - Combined Score: 0.701/1.0 - Highly Recommended
  - Average Positive Rate: 68.4%
  - Total Landmarks: 19
  - Total Comments: 25
```

## 📞 常见问题

**Q: 能否分析英文评论？**
A: 可以，但情感词汇库主要针对中文优化。英文评论可能准确性较低。

**Q: 如何增加词汇库？**
A: 编辑 `SimpleSentimentAnalyzer` 类的 `positive_words` 和 `negative_words` 字典。

**Q: 能否实时看到分析过程？**
A: 可以，程序会显示实时进度。如需调整，编辑代码中的 `flush=True` 部分。

**Q: 如何导出为其他格式？**
A: CSV文件可用Excel打开并导出为其他格式（如PDF）。

## 📝 更新日志

- v1.0 (2025-12-11) - 初始版本发布
  - 支持25个打卡点
  - 关键词权重情感分析
  - 可视化报告生成

## 📄 许可证

本项目开源，可自由使用和修改。

---

**有问题？** 检查控制台输出或查看生成的CSV文件获取详细信息。
